<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Buscaminas</title>
  <style>
    body {
      background-color: #121212;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
    }
    h1 {
      margin-top: 20px;
    }
    #minesweeper {
      border-collapse: collapse;
      margin: 20px auto;
    }
    #minesweeper td {
      width: 48px;
      height: 48px;
      background: #222;
      border: 1px solid #444;
      color: #fff;
      font-size: 1.6em;
      cursor: pointer;
      text-align: center;
      vertical-align: middle;
      user-select: none;
    }
    #minesweeper td.revealed {
      background: #444;
      cursor: default;
    }
    #minesweeper td.mine {
      background: red;
    }
    #minesweeper td.flagged {
      background: #333;
      color: orange;
    }
  </style>
</head>
<body>
  <h1>Buscaminas</h1>
  <table id="minesweeper"></table>

  <script>
    const rows = 9, cols = 9, mineCount = 9;
    const table = document.getElementById("minesweeper");
    const grid = [];
    let gameOver = false;

    function createGrid() {
      for (let r = 0; r < rows; r++) {
        const row = [];
        const tr = document.createElement("tr");
        for (let c = 0; c < cols; c++) {
          const cell = {
            element: document.createElement("td"),
            hasMine: false,
            revealed: false,
            flagged: false,
            neighborMines: 0,
          };
          cell.element.addEventListener("click", () => reveal(r, c));
          cell.element.addEventListener("contextmenu", (e) => {
            e.preventDefault();
            toggleFlag(r, c);
          });
          tr.appendChild(cell.element);
          row.push(cell);
        }
        table.appendChild(tr);
        grid.push(row);
      }

      placeMines();
      calculateNumbers();
    }

    function placeMines() {
      let placed = 0;
      while (placed < mineCount) {
        const r = Math.floor(Math.random() * rows);
        const c = Math.floor(Math.random() * cols);
        if (!grid[r][c].hasMine) {
          grid[r][c].hasMine = true;
          placed++;
        }
      }
    }

    function calculateNumbers() {
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          if (grid[r][c].hasMine) continue;
          let count = 0;
          for (let dr = -1; dr <= 1; dr++) {
            for (let dc = -1; dc <= 1; dc++) {
              const nr = r + dr, nc = c + dc;
              if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
                if (grid[nr][nc].hasMine) count++;
              }
            }
          }
          grid[r][c].neighborMines = count;
        }
      }
    }

    function reveal(r, c) {
      const cell = grid[r][c];
      if (cell.revealed || cell.flagged || gameOver) return;

      cell.revealed = true;
      cell.element.classList.add("revealed");

      if (cell.hasMine) {
        cell.element.classList.add("mine");
        cell.element.textContent = "ðŸ’£";
        gameOver = true;
        alert("Â¡Perdiste! Reiniciando...");
        location.reload();
        return;
      }

      if (cell.neighborMines > 0) {
        cell.element.textContent = cell.neighborMines;
      } else {
        for (let dr = -1; dr <= 1; dr++) {
          for (let dc = -1; dc <= 1; dc++) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
              reveal(nr, nc);
            }
          }
        }
      }

      checkWin();
    }

    function toggleFlag(r, c) {
      const cell = grid[r][c];
      if (cell.revealed || gameOver) return;

      cell.flagged = !cell.flagged;
      cell.element.classList.toggle("flagged");
      cell.element.textContent = cell.flagged ? "âš‘" : "";
    }

    function checkWin() {
      let revealedCount = 0;
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          if (grid[r][c].revealed) revealedCount++;
        }
      }
      if (revealedCount === rows * cols - mineCount) {
        gameOver = true;
        alert("Â¡Ganaste! PasÃ¡s al siguiente juego.");
        // acÃ¡ podrÃ­as redirigir a otro juego o reiniciar
      }
    }

    createGrid();
  </script>
</body>
</html>