<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Buscaminas Touch</title>
  <style>
    table {
      border-collapse: collapse;
      margin: 20px auto;
    }
    #minesweeper td {
      width: 48px;
      height: 48px;
      background: #222;
      border: 1px solid #444;
      color: #fff;
      font-size: 1.6em;
      cursor: pointer;
      text-align: center;
      vertical-align: middle;
      user-select: none;
    }
    .revealed {
      background: #888;
      cursor: default;
    }
    .mine {
      background: red;
    }
    .flagged {
      background: #444;
      color: yellow;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;">Buscaminas (Mantener para marcar mina)</h2>
  <table id="minesweeper"></table>

  <script>
    const rows = 9, cols = 9, minesCount = 9;
    let board = [], minePositions = [];

    function createBoard() {
      const table = document.getElementById('minesweeper');
      table.innerHTML = '';
      board = [];
      minePositions = [];

      // Crear tabla y celdas
      for (let i = 0; i < rows; i++) {
        const row = [];
        const tr = document.createElement('tr');
        for (let j = 0; j < cols; j++) {
          const td = document.createElement('td');
          td.dataset.row = i;
          td.dataset.col = j;
          tr.appendChild(td);
          row.push({ mine: false, revealed: false, flagged: false });
        }
        table.appendChild(tr);
        board.push(row);
      }

      // Colocar minas
      let placed = 0;
      while (placed < minesCount) {
        const r = Math.floor(Math.random() * rows);
        const c = Math.floor(Math.random() * cols);
        if (!board[r][c].mine) {
          board[r][c].mine = true;
          minePositions.push([r, c]);
          placed++;
        }
      }

      // Listeners
      document.querySelectorAll('#minesweeper td').forEach(cell => {
        let pressTimer;
        cell.addEventListener('mousedown', e => {
          pressTimer = setTimeout(() => toggleFlag(cell), 500);
        });
        cell.addEventListener('touchstart', e => {
          pressTimer = setTimeout(() => toggleFlag(cell), 500);
        });
        cell.addEventListener('mouseup', e => {
          clearTimeout(pressTimer);
          if (e.button === 0) revealCell(cell);
        });
        cell.addEventListener('touchend', e => {
          clearTimeout(pressTimer);
          if (!cell.classList.contains('flagged')) revealCell(cell);
        });
        cell.addEventListener('contextmenu', e => {
          e.preventDefault();
          toggleFlag(cell);
        });
      });
    }

    function toggleFlag(cell) {
      const r = +cell.dataset.row;
      const c = +cell.dataset.col;
      if (board[r][c].revealed) return;
      board[r][c].flagged = !board[r][c].flagged;
      cell.textContent = board[r][c].flagged ? 'ðŸš©' : '';
      cell.classList.toggle('flagged');
    }

    function revealCell(cell) {
      const r = +cell.dataset.row;
      const c = +cell.dataset.col;
      const data = board[r][c];
      if (data.revealed || data.flagged) return;

      data.revealed = true;
      cell.classList.add('revealed');

      if (data.mine) {
        cell.textContent = 'ðŸ’£';
        cell.classList.add('mine');
        alert('Â¡Perdiste!');
        createBoard();
        return;
      }

      const count = countMines(r, c);
      if (count > 0) {
        cell.textContent = count;
      } else {
        // Revelar vecinos si no hay minas alrededor
        for (let dr = -1; dr <= 1; dr++) {
          for (let dc = -1; dc <= 1; dc++) {
            const nr = r + dr;
            const nc = c + dc;
            if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
              revealCell(document.querySelector(`[data-row="${nr}"][data-col="${nc}"]`));
            }
          }
        }
      }

      checkWin();
    }

    function countMines(r, c) {
      let count = 0;
      for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
          const nr = r + dr;
          const nc = c + dc;
          if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && board[nr][nc].mine) {
            count++;
          }
        }
      }
      return count;
    }

    function checkWin() {
      let revealedCount = 0;
      for (let i = 0; i < rows; i++)
        for (let j = 0; j < cols; j++)
          if (board[i][j].revealed) revealedCount++;

      if (revealedCount === rows * cols - minesCount) {
        alert('Â¡Ganaste!');
        createBoard();
      }
    }

    createBoard();
  </script>
</body>
</html>